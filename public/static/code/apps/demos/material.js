(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"049d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){}initialize(){}buildThisCode(t){}getFragShaderCode(t){return t.reset(),t.addTextureSample2D("",!0,!0,!1),t.addVarying("vec2","v_uv"),t.addVertLayout("vec3","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_color",0),t.useVertSpaceMats(!0,!0,!0),t.addFragMainCode("\n\nvoid main()\n{\n    vec4 color4 = VOX_Texture2D(u_sampler0, v_uv);\n    color4.xyz *= u_color.xyz;\n    \n    FragColor0 = color4;\n}\n"),t.buildFragCode()}getVtxShaderCode(t){return t.addVertMainCode("\nvoid main(){\n\n    mat4 viewMat4 = u_viewMat * u_objMat;\n    vec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\n    gl_Position = u_projMat * viewPos;\n    v_uv = a_uvs;\n}\n"),t.buildVertCode()}createSharedUniforms(){return null}getUniqueShaderName(){return"ColorShd"}}e.ColorShdWrapper=r},"1cf9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("a0cf"),n=i("e385");class a{constructor(){this.m_initFlag=!0,this.m_engine=new r.EngineInstance,this.m_scene=new n.Scene}initialize(t){this.m_initFlag&&(this.m_initFlag=!1,this.m_engine.initialize(),this.m_scene=new n.Scene,this.m_scene.initialize(this.m_engine))}run(){null!=this.m_scene&&(this.m_scene.run(),this.m_engine.run())}getModuleName(){return"material"}getModuleClassName(){return"materialApp"}getRuntimeType(){return"default"}}e.App=a},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,n=i("8875");r=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var a=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},"3a50":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f");class n{constructor(){this.lightUniformDataList=[null],this.lightData=new Float32Array(12),this.lightDir=new r.Engine.Vector3D(1,-1,1),this.lightColor=new r.Engine.Color4(1,1,1),this.lightSpecular=new r.Engine.Color4(.5,.5,.8,1),this.tempV=new r.Engine.Vector3D(1,1,1),this.mat4=new r.Engine.Matrix4}initialize(){if(null==this.lightUniformDataList[0]){this.lightData.set([this.lightDir.x,this.lightDir.y,this.lightDir.z,1,this.lightColor.r,this.lightColor.g,this.lightColor.b,1,this.lightSpecular.r,this.lightSpecular.g,this.lightSpecular.b,1],0);let t=new r.Engine.ShaderUniformData;t.uniformNameList=["u_lightParams"],t.dataList=[this.lightData],this.lightUniformDataList[0]=t}}updateLightData(t){null!=this.lightData&&(this.mat4.copyFrom(t),this.mat4.transpose(),this.mat4.deltaTransformOutVector(this.lightDir,this.tempV),this.lightData[0]=-this.tempV.x,this.lightData[1]=-this.tempV.y,this.lightData[2]=-this.tempV.z)}}e.DirecLightParam=n},4707:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("84de"),n=i("8b8f");class a extends r.EntityObject{constructor(){super(!1),this.normalScale=1,this.uvPartsNumber=0,this.m_currEntity=null,this.m_currEntity=this.m_voxEntity=new n.Engine.BoxEntity}destroy(){super.destroy(),null==this.m_voxEntity&&(this.m_currEntity=null)}setVtxTransformMatrix(t){this.m_currEntity.setVtxTransformMatrix(t)}useFlatNormal(){this.m_currEntity.useFlatNormal()}useGourandNormal(){this.m_currEntity.useGourandNormal()}showBackFace(){this.m_currEntity.showBackFace()}showFrontFace(){this.m_currEntity.showFrontFace()}showAllFace(){this.m_currEntity.showAllFace()}scaleUVFaceAt(t,e,i,r,n){this.m_currEntity.scaleUVFaceAt(t,e,i,r,n)}scaleUVSFaceAt(t,e){this.m_currEntity.scaleUVSFaceAt(t,e)}reinitializeMesh(){this.m_currEntity.reinitializeMesh()}setFaceUVSAt(t,e,i=0){this.m_currEntity.setFaceUVSAt(t,e,i)}transformFaceAt(t,e){this.m_currEntity.transformFaceAt(t,e)}getFaceCenterAt(t,e){this.m_currEntity.getFaceCenterAt(t,e)}initialize(t,e,i=null){this.m_currEntity.normalScale=this.normalScale,this.m_currEntity.uvPartsNumber=this.uvPartsNumber,this.m_currEntity.initialize(t,e,i)}initializeCube(t,e){this.m_currEntity.normalScale=this.normalScale,this.m_currEntity.uvPartsNumber=this.uvPartsNumber,this.m_currEntity.initializeCube(t,e)}initializeSizeXYZ(t,e,i,r){this.m_currEntity.normalScale=this.normalScale,this.m_currEntity.uvPartsNumber=this.uvPartsNumber,this.m_currEntity.initializeSizeXYZ(t,e,i,r)}}e.BoxEntity=a},5734:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=window;void 0==r["VoxCore"]&&(r["VoxCore"]={});var n=r["VoxCore"];const a=i("1cf9");n["materialApp"]=a.App},"5b99":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f"),n=i("f6d6");class a{constructor(t){this.m_lightParam=null,this.m_colorData=null,this.m_material=null,this.m_lightParam=t,this.initialize()}initialize(){this.m_colorData=new Float32Array([1,1,1,1]);let t=new r.Engine.ShaderUniformData;t.uniformNameList=["u_color"],t.dataList=[this.m_colorData],this.m_material=new r.Engine.ShaderCodeMaterial,this.m_material.setShaderCodeWrapper(a.shaderWrapper),this.m_material.setSelfUniformData(t),this.m_material.setSharedUniformsData(this.m_lightParam.lightUniformDataList)}getMaterial(){return this.m_material}setRGBColor3f(t,e,i){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i}setRGBAColor4f(t,e,i,r){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i,this.m_colorData[4]=r}}a.shaderWrapper=new n.LightShdWrapper,e.LightMaterialWrapper=a},6098:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f"),n=i("f069");class a{constructor(t){this.m_lightParam=null,this.m_colorData=null,this.m_material=null,this.m_lightParam=t,this.initialize()}initialize(){this.m_colorData=new Float32Array([1,1,1,1]);let t=new r.Engine.ShaderUniformData;t.uniformNameList=["u_color"],t.dataList=[this.m_colorData],this.m_material=new r.Engine.ShaderCodeMaterial,this.m_material.setShaderCodeWrapper(a.shaderWrapper),this.m_material.setSelfUniformData(t),this.m_material.setSharedUniformsData(this.m_lightParam.lightUniformDataList)}getMaterial(){return this.m_material}setRGBColor3f(t,e,i){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i}setRGBAColor4f(t,e,i,r){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i,this.m_colorData[4]=r}}a.shaderWrapper=new n.NormalMapLightShdWrapper,e.NormalMapLightWrapper=a},"77f9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f"),n=i("049d");class a{constructor(){this.m_colorData=null,this.m_material=null,this.initizlize()}initizlize(){this.m_colorData=new Float32Array([1,1,1,1]);let t=new r.Engine.ShaderUniformData;t.uniformNameList=["u_color"],t.dataList=[this.m_colorData],this.m_material=new r.Engine.ShaderCodeMaterial,this.m_material.setShaderCodeWrapper(a.shaderWrapper),this.m_material.setSelfUniformData(t)}getMaterial(){return this.m_material}setRGBColor3f(t,e,i){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i}setRGBAColor4f(t,e,i,r){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i,this.m_colorData[4]=r}}a.shaderWrapper=new n.ColorShdWrapper,e.ColorMaterialWrapper=a},"84de":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f");class n{constructor(t=!0){this.m_voxEntity=null,t&&(this.m_voxEntity=r.Engine.Entity())}__$getREObj(){return this.m_voxEntity}updateMeshToGpu(t,e=!0){this.m_voxEntity.updateMeshToGpu(t,e)}updateMaterialToGpu(t,e=!0){this.m_voxEntity.updateMaterialToGpu(t,e)}setTextureList(t){this.m_voxEntity.setTextureList(t)}setTextureAt(t,e){this.m_voxEntity.setTextureAt(t,e)}setVisible(t){this.m_voxEntity.setVisible(t)}getVisible(){return this.m_voxEntity.getVisible()}getIvsIndex(){return this.m_voxEntity.getIvsIndex()}getIvsCount(){return this.m_voxEntity.getIvsCount()}setIvsParam(t,e){return this.m_voxEntity.setIvsParam(t,e)}isPolyhedral(){return this.m_voxEntity.isPolyhedral()}setRotation(t){this.m_voxEntity.setRotationXYZ(t.x,t.y,t.z)}setRotationXYZ(t,e,i){this.m_voxEntity.setRotationXYZ(t,e,i)}getRotationXYZ(t){this.m_voxEntity.getRotationXYZ(t)}setScaleXYZ(t,e,i){this.m_voxEntity.setScaleXYZ(t,e,i)}getScaleXYZ(t){this.m_voxEntity.getScaleXYZ(t)}setXYZ(t,e,i){this.m_voxEntity.setXYZ(t,e,i)}setPosition(t){this.m_voxEntity.setPosition(t)}getPosition(t){this.m_voxEntity.getPosition(t)}copyMesh(t){this.m_voxEntity.copyMesh(t)}setMesh(t){this.m_voxEntity.setMesh(t)}getMesh(){return this.m_voxEntity.getMesh()}copyMaterial(t){return this.m_voxEntity.copyMaterial(t)}setMaterial(t){return this.m_voxEntity.setMaterial(t)}getMaterial(){return this.m_voxEntity.getMaterial()}getGlobalBounds(){return this.m_voxEntity.getGlobalBounds()}getLocalBounds(){return this.m_voxEntity.getLocalBounds()}getInvMatrix(){return this.m_voxEntity.getInvMatrix()}getMatrix(){return this.m_voxEntity.getMatrix()}getToParentMatrix(){return this.m_voxEntity.getToParentMatrix()}setRenderState(t){return this.m_voxEntity.setRenderState(t)}setRenderStateByName(t){return this.m_voxEntity.setRenderStateByName(t)}isInRenderer(){return this.m_voxEntity.isInRenderer()}isRenderEnabled(){return this.m_voxEntity.isRenderEnabled()}destroy(){this.m_voxEntity.isInRenderer()||(this.m_voxEntity.destroy(),this.m_voxEntity=null)}updateBounds(){this.m_voxEntity.updateBounds()}update(){this.m_voxEntity.update()}}e.EntityObject=n},8875:function(t,e,i){var r,n,a;(function(i,o){n=[],r=o,a="function"===typeof r?r.apply(e,n):r,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var i,r,n,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,o=/@([^@]*):(\d+):(\d+)\s*$/gi,s=a.exec(d.stack)||o.exec(d.stack),l=s&&s[1]||!1,c=s&&s[2]||!1,m=document.location.href.replace(document.location.hash,""),h=document.getElementsByTagName("script");l===m&&(i=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=i.replace(r,"$1").trim());for(var u=0;u<h.length;u++){if("interactive"===h[u].readyState)return h[u];if(h[u].src===l)return h[u];if(l===m&&h[u].innerHTML&&h[u].innerHTML.trim()===n)return h[u]}return null}}return t}))},"8b8f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static GetRenderer(){return r.s_renderer}static GetRendererContext(){return r.s_rcontext}static SetDebugEnabled(t){r.RendererDevice.SHADERCODE_TRACE_ENABLED=t}static InitializeModule(t){if(null==r.s_renderer){let e=t["mainModule"];r.s_renderer=e.getRenderer(),r.s_rcontext=e.getRendererContext(),r.RendererDevice=t.RendererDevice,r.ImageTextureProxy=t.ImageTextureProxy,r.ImageTextureProxy=t.ImageTextureProxy,r.Entity=t.DisplayEntity,r.AxisEntity=t.Axis3DEntity,r.PlaneEntity=t.Plane3DEntity,r.BoxEntity=t.Box3DEntity,r.SphereEntity=t.Sphere3DEntity,r.CylinderEntity=t.Cylinder3DEntity,r.BillboardEntity=t.Billboard3DEntity,r.LineEntity=t.Line3DEntity,r.DashedLineEntity=t.DashedLine3DEntity,r.BoxFrameEntity=t.BoxFrame3D,r.FrustrumFrameEntity=t.FrustrumFrame3DEntity,r.MathConst=t.MathConst,r.Vector3D=t.Vector3D,r.Color4=t.Color4,r.Matrix4=t.Matrix4,r.AABB=t.AABB,r.Camera=t.CameraBase,r.ShaderCodeMaterial=t.ShaderCodeMaterial,r.ShaderUniformData=t.ShaderUniformData}}}r.s_renderer=null,r.s_rcontext=null,e.Engine=r;var n=window;void 0==n["VoxCore"]&&(n["VoxCore"]={});var a=n["VoxCore"];a["VoxAppEngine"]=r},a0cf:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f");class n{constructor(){this.m_renderer=null,this.m_rcontext=null}initialize(){null==this.m_renderer&&(this.m_renderer=r.Engine.GetRenderer(),this.m_rcontext=r.Engine.GetRendererContext())}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}setClearRGBColor3f(t,e,i){this.m_rcontext.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,r){this.m_rcontext.setClearRGBAColor4f(t,e,i,r)}begin(){this.m_rcontext.renderBegin()}update(){this.m_renderer.update()}render(){this.m_renderer.run()}renderAt(t){this.m_renderer.runAt(t)}end(){this.m_rcontext.runEnd()}run(){this.m_rcontext.renderBegin(),this.m_renderer.update(),this.m_renderer.run(),this.m_rcontext.runEnd()}addEntity(t,e=0){let i=t;void 0!=i.__$getREObj&&(t=i.__$getREObj()),this.m_renderer.addEntity(t,e)}removeEntity(t){let e=t;void 0!=e.__$getREObj&&(t=e.__$getREObj()),this.m_renderer.removeEntity(t)}removeEntityByProcessIndex(t,e){this.m_renderer.removeEntityByProcessIndex(t,e)}appendProcess(t=!0,e=!1){this.m_renderer.appendProcess(t,e)}drawEntity(t,e=!1,i=!0){this.m_renderer.drawEntity(t,e,i)}getCamera(){return this.m_rcontext.getCamera()}updateCamera(){this.m_rcontext.updateCamera()}}e.EngineInstance=n},b52d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){}initialize(){}buildThisCode(t){}getFragShaderCode(t){return t.reset(),t.normalMapEanbled=!0,t.vertMatrixInverseEnabled=!0,t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addVarying("vec2","v_uv"),t.addVarying("vec3","v_nv"),t.addVarying("vec3","v_viewPos"),t.addVertLayout("vec3","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec3","a_nvs"),t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_color",0),t.addFragUniform("vec4","u_lightParams",3),t.useVertSpaceMats(!0,!0,!0),t.addFragMainCode("\nconst vec4 occParam = vec4(1.0,10.0,2.0,0.1);\nvec2 paralOccRayMarchDep2(sampler2D texSampler, vec2 puvs, vec3 viewDir,vec4 poccParam)\n{\n    float depthValue = 1.0 - texture(texSampler, puvs).r;\n    float numLayers = mix(poccParam.x, poccParam.y, max(dot(vec3(0.0, 0.0, 1.0), viewDir),0.0));\n    float layerHeight = poccParam.z / numLayers;\n    vec2 tuv = (viewDir.xy * poccParam.w) / numLayers;  \n    float ph = 0.0;\n    while(ph < depthValue)\n    {\n        puvs -= tuv;\n        depthValue = 1.0 - texture(texSampler, puvs).r;\n        ph += layerHeight;\n    }\n    tuv += puvs;\n    depthValue -= ph;\n    ph = 1.0 - texture(texSampler, tuv).r - ph + layerHeight;\n    float weight = depthValue / (depthValue - ph);\n    return tuv * weight + puvs * (1.0 - weight);\n}\nmat3 getBTN(vec2 texUV, vec3 pos, vec3 nv)\n{\n    vec3 Q1  = dFdx(pos);\n    vec3 Q2  = dFdy(pos);\n    vec2 st1 = dFdx(texUV);\n    vec2 st2 = dFdy(texUV);\n\n    vec3 N  = normalize(nv);\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \n    vec3 B  = -normalize(cross(N, T));\n    return mat3(T, B, N);\n}\nvec3 getNormalFromMap(sampler2D texSampler, vec2 texUV, vec3 pos, vec3 nv)\n{\n    vec3 tangentNormal = VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\n\n    vec3 Q1  = dFdx(pos);\n    vec3 Q2  = dFdy(pos);\n    vec2 st1 = dFdx(texUV);\n    vec2 st2 = dFdy(texUV);\n\n    vec3 N   = normalize(nv);\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \n    vec3 B  = -normalize(cross(N, T));\n    mat3 TBN = mat3(T, B, N);\n\n    return TBN * tangentNormal;\n}\nvec3 calcLight(vec3 baseColor, vec3 pLightDir, vec3 lightColor, vec3 specColor, vec3 viewDir, vec3 nv, float specFactor) {\n\n    float nDotL = max(dot(nv, pLightDir), 0.0);\n\tbaseColor = nDotL * baseColor * lightColor;\n\tviewDir = normalize(pLightDir + viewDir);\n\tlightColor = specColor * nDotL * pow(max(dot(nv, viewDir), 0.0), 64.0 * specFactor);\n\treturn (baseColor * 0.3 + lightColor * 0.7);\n}\n\nvoid main()\n{\n    vec3 viewPos = v_viewPos;\n    vec3 viewDir = -normalize(viewPos);\n    \n    vec3 nv = v_nv;\n    vec3 btnViewDir = getBTN(v_uv.xy, viewPos, v_nv) * viewDir;\n\n    vec2 puv = paralOccRayMarchDep2(u_sampler4, v_uv, btnViewDir, occParam);\n\n    nv = getNormalFromMap(u_sampler1, puv, viewPos, v_nv);\n    vec4 color4 = VOX_Texture2D(u_sampler0, puv);\n    color4.xyz *= u_color.xyz;\n\n    vec4 specular = VOX_Texture2D(u_sampler2, puv);\n    vec4 occ = VOX_Texture2D(u_sampler3, puv);\n\n    vec3 lightDirec = u_lightParams[0].xyz;\n    vec3 lightColor = u_lightParams[1].xyz;\n    vec3 lightSpecColor = u_lightParams[2].xyz;\n\n    vec3 destColor = calcLight(\n        color4.xyz,\n        lightDirec,\n        lightColor,\n        lightSpecColor,\n        viewDir,\n        nv,\n        specular.x\n    );\n    destColor.xyz *= occ.xxx;\n    FragColor0 = vec4(destColor * 0.9 + 0.4 * color4.xyz, 1.0);\n}\n"),t.buildFragCode()}getVtxShaderCode(t){return t.addVertMainCode("\nvoid main(){\n\n    mat4 viewMat4 = u_viewMat * u_objMat;\n    vec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\n    gl_Position = u_projMat * viewPos;\n\n    v_viewPos = (viewPos.xyz);\n    //v_viewDir = -normalize(viewPos.xyz);\n    v_uv = a_uvs;\n    v_nv = normalize(a_nvs * inverse(mat3(viewMat4)));\n}\n"),t.buildVertCode()}createSharedUniforms(){return null}getUniqueShaderName(){return"ParallaxMapLightShd"}}e.ParallaxMapLightShdWrapper=r},d2a5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f");class n{constructor(){this.m_matrix=new r.Engine.Matrix4,this.m_position=new r.Engine.Vector3D,this.m_direction=new r.Engine.Vector3D,this.m_angle=0,this.m_updateEnabled=!1,this.m_camera=null}destroy(){this.m_camera=null}bindCamera(t){this.m_camera=t,null!=t&&(this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()))}update(){null!=this.m_camera&&this.m_updateEnabled&&(this.m_updateEnabled=!1)}rotationOffsetAngleWorldY(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationY(this.m_angle*r.Engine.MathConst.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.setPosition(this.m_position)}rotationOffsetAngleWordX(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationX(this.m_angle*r.Engine.MathConst.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.setPosition(this.m_position)}rotationOffsetAngleWordZ(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationZ(this.m_angle*r.Engine.MathConst.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.setPosition(this.m_position)}}e.CameraCtrl=n},e385:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f"),n=i("d2a5"),a=i("4707"),o=i("3a50"),s=i("77f9"),l=i("5b99"),c=i("6098"),m=i("f7d8");class h{constructor(t){this.m_entity=t,this.m_rotV=new r.Engine.Vector3D(100*Math.random(),100*Math.random(),100*Math.random()),this.m_spdV=new r.Engine.Vector3D(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}run(){this.m_rotV.addBy(this.m_spdV),this.m_entity.setRotation(this.m_rotV),this.m_entity.update()}}class u{constructor(){this.m_engine=null,this.m_lightParam=null,this.m_motionObjs=[],this.m_fpsModule=null,this.m_fpsModuleFlag=!0,this.m_camTrack=null}loaFPSModule(){if(this.m_fpsModuleFlag){this.m_fpsModuleFlag=!1;let e="fps",i=e+"App",r=window;var t=r["VoxCore"];let n=t["voxAppModuleLoader"];n.hasModuleByName(e),n.load("static/code/apps/demos/"+e+".js",()=>{this.m_fpsModule=new t[i],this.m_fpsModule.initialize(t)},e,i)}}initEvt(){document.onmousedown=t=>{this.loaFPSModule()}}createTexture(t){let e=new r.Engine.ImageTextureProxy(64,64),i=new Image;return i.src=t,i.onload=t=>{e.setDataFromImage(i)},e}initialize(t){if(null==this.m_engine){this.m_engine=t;let e="box",i=this.createTexture("static/assets/disp/"+e+"_COLOR.png"),a=this.createTexture("static/assets/disp/"+e+"_NRM.png"),s=this.createTexture("static/assets/disp/"+e+"_SPEC.png"),l=this.createTexture("static/assets/disp/"+e+"_DISP.png"),c=this.createTexture("static/assets/disp/"+e+"_OCC.png");this.m_lightParam=new o.DirecLightParam,this.m_lightParam.initialize(),this.initEvt(),this.m_camTrack=new n.CameraCtrl,this.m_camTrack.bindCamera(this.m_engine.getCamera()),this.createParallaxMapEntity(i,a,s,l,c,new r.Engine.Vector3D(800,0,0)),this.createNormalMapEntity(i,a,s,l,new r.Engine.Vector3D(200,0,0)),this.createLightEntity(i,new r.Engine.Vector3D(-400,0,0)),this.createColorEntity(i,new r.Engine.Vector3D(-1e3,0,0))}}createParallaxMapEntity(t,e,i,n,o,s){let l=new m.ParallaxMapLightWrapper(this.m_lightParam),c=new r.Engine.Color4;c.normalizeRandom(2),l.setRGBColor3f(c.r,c.g,c.b);let u=new a.BoxEntity;u.setMaterial(l.getMaterial()),u.initializeCube(500,[t,e,i,n,o]),u.setPosition(s),this.m_engine.addEntity(u),this.m_motionObjs.push(new h(u))}createNormalMapEntity(t,e,i,n,o){let s=new c.NormalMapLightWrapper(this.m_lightParam),l=new r.Engine.Color4;l.normalizeRandom(2),s.setRGBColor3f(l.r,l.g,l.b);let m=new a.BoxEntity;m.setMaterial(s.getMaterial()),m.initializeCube(500,[t,e,i,n]),m.setPosition(o),this.m_engine.addEntity(m),this.m_motionObjs.push(new h(m))}createLightEntity(t,e){let i=new l.LightMaterialWrapper(this.m_lightParam),n=new r.Engine.Color4;n.normalizeRandom(2),i.setRGBColor3f(n.r,n.g,n.b);let o=new a.BoxEntity;o.setMaterial(i.getMaterial()),o.initializeCube(500,[t]),o.setPosition(e),this.m_engine.addEntity(o),this.m_motionObjs.push(new h(o))}createColorEntity(t,e){let i=new s.ColorMaterialWrapper,n=new r.Engine.Color4;n.normalizeRandom(1.5),i.setRGBColor3f(n.r,n.g,n.b);let o=new a.BoxEntity;o.setMaterial(i.getMaterial()),o.initializeCube(500,[t]),o.setPosition(e),this.m_engine.addEntity(o),this.m_motionObjs.push(new h(o))}run(){null!=this.m_fpsModule&&this.m_fpsModule.run(),null!=this.m_camTrack&&(this.m_camTrack.rotationOffsetAngleWorldY(-.2),this.m_engine.updateCamera());for(let t=0;t<this.m_motionObjs.length;++t)this.m_motionObjs[t].run();this.m_lightParam.updateLightData(this.m_engine.getCamera().getViewInvMatrix())}}e.Scene=u},f069:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){}initialize(){}buildThisCode(t){}getFragShaderCode(t){return t.reset(),t.normalMapEanbled=!0,t.vertMatrixInverseEnabled=!0,t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addTextureSample2D("",!0,!0,!1),t.addVarying("vec2","v_uv"),t.addVarying("vec3","v_nv"),t.addVarying("vec3","v_viewPos"),t.addVertLayout("vec3","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec3","a_nvs"),t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_color",0),t.addFragUniform("vec4","u_lightParams",3),t.useVertSpaceMats(!0,!0,!0),t.addFragMainCode("\nvec3 getNormalFromMap(sampler2D texSampler, vec2 texUV, vec3 pos, vec3 nv)\n{\n    vec3 tangentNormal = VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\n\n    vec3 Q1  = dFdx(pos);\n    vec3 Q2  = dFdy(pos);\n    vec2 st1 = dFdx(texUV);\n    vec2 st2 = dFdy(texUV);\n\n    vec3 N   = normalize(nv);\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \n    vec3 B  = -normalize(cross(N, T));\n    mat3 TBN = mat3(T, B, N);\n\n    return TBN * tangentNormal;\n}\nvec3 calcLight(vec3 baseColor, vec3 pLightDir, vec3 lightColor, vec3 specColor, vec3 viewDir, vec3 nv, float specFactor) {\n\n    float nDotL = max(dot(nv, pLightDir), 0.0);\n\tbaseColor = nDotL * baseColor * lightColor;\n\tviewDir = normalize(pLightDir + viewDir);\n\tlightColor = specColor * nDotL * pow(max(dot(nv, viewDir), 0.0), 64.0 * specFactor);\n\treturn (baseColor * 0.3 + lightColor * 0.7);\n}\n\nvoid main()\n{\n    vec4 color4 = VOX_Texture2D(u_sampler0, v_uv);\n    color4.xyz *= u_color.xyz;\n    vec3 viewPos = v_viewPos;\n    vec3 viewDir = -normalize(viewPos);\n    vec3 nv = getNormalFromMap(u_sampler1, v_uv.xy, viewPos, v_nv);\n\n    vec4 specular = VOX_Texture2D(u_sampler2, v_uv);\n    vec4 occ = VOX_Texture2D(u_sampler3, v_uv);\n\n    vec3 lightDirec = u_lightParams[0].xyz;\n    vec3 lightColor = u_lightParams[1].xyz;\n    vec3 lightSpecColor = u_lightParams[2].xyz;\n\n    vec3 destColor = calcLight(\n        color4.xyz,\n        lightDirec,\n        lightColor,\n        lightSpecColor,\n        viewDir,\n        nv,\n        specular.x\n    );\n    destColor.xyz *= occ.xxx;\n    FragColor0 = vec4(destColor * 0.9 + 0.4 * color4.xyz, 1.0);\n}\n"),t.buildFragCode()}getVtxShaderCode(t){return t.addVertMainCode("\nvoid main(){\n\n    mat4 viewMat4 = u_viewMat * u_objMat;\n    vec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\n    gl_Position = u_projMat * viewPos;\n\n    v_viewPos = (viewPos.xyz);\n    //v_viewDir = -normalize(viewPos.xyz);\n    v_uv = a_uvs;\n    v_nv = normalize(a_nvs * inverse(mat3(viewMat4)));\n}\n"),t.buildVertCode()}createSharedUniforms(){return null}getUniqueShaderName(){return"NormalMapLightShd"}}e.NormalMapLightShdWrapper=r},f6d6:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){}initialize(){}buildThisCode(t){}getFragShaderCode(t){return t.reset(),t.vertMatrixInverseEnabled=!0,t.addTextureSample2D("",!0,!0,!1),t.addVarying("vec2","v_uv"),t.addVarying("vec3","v_nv"),t.addVarying("vec3","v_viewDir"),t.addVertLayout("vec3","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec3","a_nvs"),t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_color",0),t.addFragUniform("vec4","u_lightParams",3),t.useVertSpaceMats(!0,!0,!0),t.addFragMainCode("\nvec3 calcLight(vec3 baseColor, vec3 pLightDir, vec3 lightColor, vec3 specColor) {\n\n    vec3 nvs = (v_nv);\n\tvec3 viewDir = v_viewDir;\n    float nDotL = max(dot(nvs, pLightDir), 0.0);\n\tbaseColor = nDotL * baseColor * lightColor;\n\tviewDir = normalize(pLightDir + viewDir);\n\tlightColor = specColor * nDotL * pow(max(dot(nvs, viewDir), 0.0), 32.0);\n\treturn (baseColor * 0.3 + lightColor * 0.7);\n}\n\nvoid main()\n{\n    vec4 color4 = VOX_Texture2D(u_sampler0, v_uv);\n    color4.xyz *= u_color.xyz;\n    \n    vec3 lightDirec = u_lightParams[0].xyz;\n    vec3 lightColor = u_lightParams[1].xyz;\n    vec3 lightSpecColor = u_lightParams[2].xyz;\n\n    vec3 destColor = calcLight(\n        color4.xyz,\n        lightDirec,\n        lightColor,\n        lightSpecColor\n    );\n    FragColor0 = vec4(destColor * 0.9 + 0.4 * color4.xyz, 1.0);\n}\n"),t.buildFragCode()}getVtxShaderCode(t){return t.addVertMainCode("\nvoid main(){\n\n    mat4 viewMat4 = u_viewMat * u_objMat;\n    vec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\n    gl_Position = u_projMat * viewPos;\n\n    v_viewDir = -normalize(viewPos.xyz);\n    v_uv = a_uvs;\n    v_nv = normalize(a_nvs * inverse(mat3(viewMat4)));\n}\n"),t.buildVertCode()}createSharedUniforms(){return null}getUniqueShaderName(){return"LightShd"}}e.LightShdWrapper=r},f7d8:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("8b8f"),n=i("b52d");class a{constructor(t){this.m_lightParam=null,this.m_colorData=null,this.m_material=null,this.m_lightParam=t,this.initialize()}initialize(){this.m_colorData=new Float32Array([1,1,1,1]);let t=new r.Engine.ShaderUniformData;t.uniformNameList=["u_color"],t.dataList=[this.m_colorData],this.m_material=new r.Engine.ShaderCodeMaterial,this.m_material.setShaderCodeWrapper(a.shaderWrapper),this.m_material.setSelfUniformData(t),this.m_material.setSharedUniformsData(this.m_lightParam.lightUniformDataList)}getMaterial(){return this.m_material}setRGBColor3f(t,e,i){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i}setRGBAColor4f(t,e,i,r){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=i,this.m_colorData[4]=r}}a.shaderWrapper=new n.ParallaxMapLightShdWrapper,e.ParallaxMapLightWrapper=a},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var r=i("5734");for(var n in r)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return r[t]}))}(n)}})}));